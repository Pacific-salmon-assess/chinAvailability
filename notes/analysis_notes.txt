Notes for Chinook availability project

Feb. 16, 2022
- Considerable variation in stock composition among areas within region, as well as variation in temporal sampling coverage (see figs/data_coverage/ directory). Ideally model with hierarchical GAMs. Alternatively consider restratifying to "subregions" using cluster analysis.
- Coverage at beginning/end of the year very sparse; consider truncating to March-Sep for SSoG and JdFS if convergence issues pronounced
- Issues with estimating abundance at year end; restrict catch data to be only in peak periods (non-cyclic); similarly for GSI, fit model to full dataset but constrain predictions to months with catch data


Feb. 17, 2022
- Why does fit random = FALSE still produce interannual variability in predictions?
- Switch model from summing aggregates to flexibly producing predictions based on minimum scale of data (original is negbin_rsplines_dirichlet_mvn_cumsum)
- Issues with negbin component when generating area predictions


Feb. 18, 2022
- Confirmed negbin component functional with areas; bug due to double-logging predictions; remember moderate differences between mgcv expected due to RIs being fit
- Rediscovered issue where convergence fails when fixed effects used as inits; adjust model_fit function accordingly


March 20, 2022
- For now use random intercepts by area and random smooths by region for dirichlet component (hierarchical smooths failed to converge); details in dirichlet_explore.R
- Composition component may require pooling less common stocks for convergence (see dirichlet_explore.R)
- Compositon fits look reasonable (note that predictions include a subset of data and are influenced by full dataset, hence why full 12 month cycle can be estimated)

March 28, 2022 
- Shift development to cam-dev branch of stockseasonr

March 31, 2022
- Removed Jan/Nov/Dec data and switched composition component to agg ~ area + s(month_n, bs = "tp", k = 4, by = reg, m = 2); alternatives that used hierarchical smooths for area or include bs = "cc" were unstable
- Simplify integrated model to include single set of predictions for composition and abundance portion of the model; save original formulation and utility functions as "integrated_stock_composition_EXPANDED.R" and "negbin_rsplines_dirichlet_MVN_EXPANDED.cpp"

April 1, 2022
- Convergence issues with integrated model (vector memory exhausted)

April 5, 2022
- Address vector memory issues by removing non-essential ADREPORT from integrated model

April 14, 2022
- Begin investigating subarea stock comp
- Pool US7 and 19B, 21A and 21B due to small sample sizes; remove 18A, 19A, 18E outside study area and small sample sizes
- Considered incorporating 123I but composition is quite different (large inputs of RCH fish) and worried it will skew results
- Proposed framework:
	- Fit hierarchical GAM w/ smooths by region (SWVI, JdF, SSoG) and intercepts by subarea
	- Constrain predictions to focus on areas that overlap with RKW foraging: 21A, 121A, 121B, 19C, 19B, 18B
- Fit initial model, but required removing data poor strata (subareas and months)
- Next steps check against observations and experiment with different levels of stock clumping 

April 21, 2022
- Consolidate several subareas after identifying troubles with convergence
    - 19CDE and 20CDE
    - Also remove 18D
- Issues with unrealistc curves when k = 3 and shared smooth, but k = 4 doesn't work with shared or without (latter barely)

May 1, 2022
- Focus on higher stock resolution (Canadian MUs); most stable model includes region-specific smooths and no hyper smooth with 3 knots
- Experimented with using week as a covariate 
    - No convergence -- hypersmooth + 3 knots, no hypersmooth + 3 knots, no hypersmooth + 4 knots
    - Tried truncating input data, still no convergence
- Tried changing sample_id to aggregate by week rather than day 
    - No joy with: no hypersmooth + 4 knots, hypersmooth + 3 knots, hypersmooth + 4 knots, no hypersmooth + 3 knots

May 4, 2022
- Included all seasonal data and fit with high resolution stock data and monthly covariate
	- Converged with hypersmooth only + CC + 4 knots
	- No joy with hypersmooth + regional smooths + 4 knots/CC
	- No joy with regional smooths + 4 knots/CC

Jun 2, 2022
- Rebinned SSoG data so that 18D/E included with 18B
- Combined SOMN with ECVI
- Refit 
	- All months and CC + 4 knots -> converges and looks ok
	- subset of months and TP + 3 knots -> and looks ok

June 17, 2022
- Experimented with including distance covariate instead of fixed intercepts for subareas, but too much shrinkage even with interaction between te() and month
- Unable to add random intercepts as well distance covariate